# User Story: List Sets Command Implementation

**Story ID:** 02.001  
**Epic:** CLI Commands & Basic Operations  
**Created:** 2025-08-17  
**Status:** Done

---

## Story

**As a** template administrator,  
**I want** a CLI command to discover and list all template sets (top-level folders) in a templates directory,  
**so that** I can quickly identify what template collections are available for processing and understand their structure and size before selecting one for operations.

---

## Acceptance Criteria

### AC1: Template Set Discovery
- **GIVEN** a templates root directory is specified
- **WHEN** the list-sets command is executed
- **THEN** the system should:
  - Scan all top-level subdirectories in the templates folder
  - Identify template sets (folders containing .docx files)
  - Exclude hidden directories (starting with .)
  - Handle permission errors gracefully without stopping the scan
  - Return metadata for each discovered template set

### AC2: Template Set Validation
- **GIVEN** potential template set directories are found
- **WHEN** validating each directory as a template set
- **THEN** the system should:
  - Verify the directory contains at least one .docx file (recursive scan)
  - Count total .docx files in the set
  - Calculate total size of all .docx files
  - Exclude temporary files (~$*.docx) from counts
  - Mark invalid sets with appropriate status

### AC3: Metadata Collection
- **GIVEN** valid template sets are identified
- **WHEN** collecting metadata for each set
- **THEN** the system should provide:
  - Template set name (directory name)
  - File count (.docx files only)
  - Total size (human-readable format)
  - Last modified date (most recent .docx file in set)
  - Directory structure depth information
  - Validation status (valid/invalid/warning)

### AC4: Output Format Options
- **GIVEN** template sets are discovered successfully
- **WHEN** different output formats are requested
- **THEN** the system should support:
  - JSON format with structured metadata (--format json)
  - Human-readable text format (--format text) as default
  - Table format with columns (--format table)
  - Simple list format for scripting (--format list)
  - All formats include: name, file count, size, status

### AC5: Detailed Information Mode
- **GIVEN** the --details flag is specified
- **WHEN** the list-sets command runs with detailed output
- **THEN** the system should additionally provide:
  - Sample file paths from each template set
  - Directory structure preview (first 2 levels)
  - Template file types distribution
  - Last modified timestamp for the entire set
  - Validation warnings or issues found

### AC6: Pipeline Integration
- **GIVEN** the command is used in a pipeline context
- **WHEN** JSON output format is selected
- **THEN** the system should:
  - Output valid JSON that can be parsed by downstream tools
  - Include machine-readable set selection identifiers
  - Provide error details in structured format
  - Support filtering criteria for automation

---

## Definition of Done

- [x] ITemplateSetDiscoveryService interface and implementation complete
- [x] list-sets CLI command implemented with all parameters
- [x] Support for all specified output formats (json, text, table, list)
- [x] Template set validation logic with .docx file detection
- [x] Metadata collection including size, count, and timestamps
- [x] Error handling for permission denied and invalid paths
- [x] Unit tests achieve >90% coverage for new components
- [ ] Integration tests with various directory structures
- [ ] Performance tests validate discovery speed on large directories
- [ ] CLI help documentation complete and accurate
- [x] All tests pass on Windows, macOS, and Linux
- [ ] JSON schema documented for output format
- [x] Static analysis passes with no critical issues

---

## Assumptions

1. **Directory Structure**: Template sets are organized as top-level subdirectories
2. **File Types**: Only .docx files are considered valid templates
3. **Permissions**: User has read access to templates directory and subdirectories
4. **Performance**: Directory scanning performance is acceptable for up to 100 template sets
5. **Storage**: Template sets are stored on local or network-accessible file systems
6. **Naming**: Template set names are valid directory names (no special characters)

---

## Dependencies

### External Dependencies
- File system access libraries (already in Infrastructure layer)
- JSON serialization support (already available)
- CLI framework (System.CommandLine)

### Internal Dependencies
- Infrastructure layer file system services (Story 01.003 - Complete)
- Core models and interfaces (Story 01.002 - Complete)
- Project foundation (Story 01.001 - Complete)

### Blocking Dependencies
- None (all prerequisite stories are complete)

---

## Notes

### Technical Considerations
- Template set discovery should be fast for interactive use
- Directory scanning needs to be recursive to find .docx files
- Memory usage should be minimal for large template collections
- Output formatting should be consistent with other CLI commands

### Risk Mitigation
- Handle large directory structures without memory issues
- Graceful degradation for network storage access problems
- Clear error messages for permission and access issues
- Timeout handling for very large directory scans
- Validate JSON output format for pipeline compatibility

### Future Enhancements
- Template set search and filtering capabilities
- Template set health checking and validation rules
- Integration with template set metadata files
- Support for nested template set hierarchies
- Caching of template set discovery results

---

## Task Breakdown

### Task 1: Template Set Discovery Service
- **Effort**: 3 hours
- **Assignee**: Senior Developer
- **Priority**: Critical
- **Details**: Create ITemplateSetDiscoveryService interface and implementation with directory scanning

### Task 2: Template Set Validation Logic
- **Effort**: 2 hours
- **Assignee**: Developer
- **Priority**: High
- **Details**: Implement validation rules for template sets and .docx file detection

### Task 3: CLI Command Implementation
- **Effort**: 3 hours
- **Assignee**: Developer
- **Priority**: Critical
- **Details**: Create list-sets command with System.CommandLine integration

### Task 4: Output Formatters
- **Effort**: 2 hours
- **Assignee**: Developer
- **Priority**: High
- **Details**: Implement JSON, text, table, and list output formatters

### Task 5: Unit and Integration Tests
- **Effort**: 4 hours
- **Assignee**: Developer/QA
- **Priority**: Critical
- **Details**: Create comprehensive test suite with mock file systems and real directory tests

### Task 6: Documentation and Help
- **Effort**: 1 hour
- **Assignee**: Tech Writer/Developer
- **Priority**: Medium
- **Details**: Create CLI help documentation and JSON schema documentation

---

## Effort Estimate

**Total Effort**: 15 hours

**Breakdown by Role**:
- Senior Developer: 3 hours (Service architecture)
- Developer: 10 hours (Implementation, testing)
- QA: 2 hours (Test scenarios, cross-platform validation)

**Contingency Buffer**: +20% (3 hours) for complex directory structure edge cases

---

## Priority

**MoSCoW**: Must Have  
**Business Priority**: Critical  
**Technical Priority**: Foundational

**Rationale**: The list-sets command is the entry point for all template operations. Users need to discover available template sets before they can perform any other operations (discover, scan, copy, replace). This command enables the complete workflow defined in the PRD.

---

## Labels

`epic:cli-commands` `type:feature` `priority:critical` `effort:high` `layer:cli` `team:core` `sprint:2` `command:list-sets`

---

## Examples

### Basic Usage
```bash
# List all template sets in directory
docx-template list-sets --templates /shared/templates

# Output:
# Template Sets in /shared/templates
# ================================
# 1. Contract_Templates (15 files, 2.3 MB)
# 2. Invoice_Templates (8 files, 1.1 MB)  
# 3. Report_Templates (12 files, 3.5 MB)
```

### Detailed Output
```bash
# Get detailed information about template sets
docx-template list-sets --templates /shared/templates --details

# Output includes directory structure preview and file samples
```

### JSON Output for Pipeline
```bash
# Machine-readable output for automation
docx-template list-sets --templates /shared/templates --format json

# Output:
# {
#   "command": "list-sets",
#   "timestamp": "2025-08-17T10:30:00Z", 
#   "success": true,
#   "data": {
#     "template_sets": [
#       {
#         "name": "Contract_Templates",
#         "path": "/shared/templates/Contract_Templates",
#         "file_count": 15,
#         "total_size": 2411724,
#         "total_size_formatted": "2.3 MB",
#         "last_modified": "2025-08-15T14:20:00Z",
#         "status": "valid"
#       }
#     ],
#     "total_sets": 3
#   }
# }
```