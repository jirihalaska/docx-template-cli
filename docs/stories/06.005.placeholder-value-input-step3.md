# Story 06.005: Step 3 - Placeholder Value Input

## User Story

As a business administrator using the GUI template processor,
I want to input values for each discovered placeholder in a clear, organized form,
So that I can provide the information I have available and proceed even with some placeholders unfilled.

## Story Context

**Existing System Integration:**
- Integrates with: Placeholder data from Step 2 (06.004), wizard navigation from 06.002
- Technology: Avalonia UI forms, ReactiveUI data binding, .NET 9
- Follows pattern: Wizard step navigation and data flow from previous steps
- Touch points: MainViewModel placeholder collection, form validation, JSON value mapping

## Acceptance Criteria

**Functional Requirements:**

1. **Dynamic Form Generation**
   - Create text input field for each placeholder discovered in Step 2
   - Display placeholder names as clear labels (e.g., "NÁZEV_FIRMY:", "DATUM_SMLOUVY:")
   - Maintain same order as Step 2 placeholder discovery list
   - Use standard Avalonia TextBox controls with proper data binding

2. **Value Input and Optional Completion**
   - Accept text input with automatic whitespace normalization (newlines, tabs, multiple spaces → single space)
   - Allow progression to next step regardless of completion status (no required fields)
   - Provide clear visual indication of filled vs. unfilled fields
   - Show warning indicator for unfilled fields (e.g., orange border or icon)
   - Support standard keyboard navigation (Tab between fields, Enter to advance)

3. **User Assistance and Warning Features**
   - "Vymazat vše" (Clear All) button to reset all input fields
   - Summary showing count of filled vs. unfilled placeholders (e.g., "5 of 8 placeholders filled")
   - Clear explanation that unfilled placeholders will remain as {{PLACEHOLDER}} in output
   - Visual distinction between filled (normal) and unfilled (warning style) fields

**Integration Requirements:**

4. Existing wizard navigation from 06.002 continues to work unchanged
5. Placeholder data from Step 2 (06.004) flows correctly into input form
6. Values collected create proper JSON mapping structure for CLI replace command (only includes filled placeholders)

**Quality Requirements:**

7. Form layout handles variable number of placeholders gracefully (scrolling if needed)
8. Visual feedback updates immediately as user types (filled/unfilled status)
9. "Back" button preserves entered values when returning from Step 4

## Technical Notes

- **Integration Approach:** Use ReactiveUI ObservableCollection for dynamic form generation with two-way binding
- **Existing Pattern Reference:** Follow MVVM patterns from 06.001 setup and visual feedback patterns from wizard framework 06.002
- **Key Constraints:** JSON mapping includes only filled placeholders; unfilled placeholders are excluded from replace operation

## Definition of Done

- [x] Dynamic form generates input fields for all placeholders from Step 2
- [x] All text inputs support whitespace normalization and visual feedback
- [x] "Next" button is always enabled (no required field blocking)
- [x] Unfilled fields display with clear visual warning (orange border/icon)
- [x] Summary shows "X of Y placeholders filled" count
- [x] Clear user explanation that unfilled placeholders remain as {{PLACEHOLDER}} in output
- [x] "Vymazat vše" button clears all input fields and resets visual states
- [x] "Back" button returns to Step 2 while preserving entered values
- [x] Form layout handles 1-20+ placeholders with proper scrolling
- [x] JSON mapping includes only filled placeholders (empty fields excluded)

## Risk and Compatibility Check

**Primary Risk:** User confusion about which placeholders will remain unfilled in output documents
**Mitigation:** Clear visual indicators, completion summary, and explicit warning about unfilled placeholders
**Rollback:** "Back" button allows return to Step 2, "Clear All" allows starting over with all fields

**Compatibility Verification:**

- [x] No breaking changes to existing wizard step navigation
- [x] Data binding follows established ReactiveUI patterns
- [x] JSON output format matches CLI `replace` command requirements (partial replacement supported)
- [x] CLI `replace` command handles partial placeholder maps correctly
- [x] Performance remains responsive with 20+ input fields with visual feedback

---

## Dev Agent Record

**Agent Model Used:** claude-sonnet-4-20250514

### Tasks Completed:
- [x] Create PlaceholderInputViewModel with ReactiveUI ObservableCollection for dynamic form generation
- [x] Implement dynamic form generation for placeholder input fields with two-way data binding
- [x] Add text input whitespace normalization and visual feedback (filled/unfilled status)
- [x] Implement 'Vymazat vše' (Clear All) button functionality  
- [x] Add completion summary showing 'X of Y placeholders filled' count
- [x] Add user explanation that unfilled placeholders remain as {{PLACEHOLDER}} in output
- [x] Ensure form layout handles 1-20+ placeholders with proper scrolling
- [x] Integrate Step 3 ViewModel into WizardViewModel with data flow from Step 2
- [x] Update Step3PlaceholderInputView.axaml with complete UI implementation
- [x] Write unit tests for PlaceholderInputViewModel
- [x] Ensure JSON mapping includes only filled placeholders (exclude empty fields)
- [x] Validate with build and test execution

### File List:
- **NEW:** `src/DocxTemplate.UI/ViewModels/PlaceholderInputViewModel.cs` - Main ViewModel with PlaceholderInputItemViewModel
- **NEW:** `src/DocxTemplate.UI/Converters/BooleanToBrushConverter.cs` - Visual feedback converter
- **MODIFIED:** `src/DocxTemplate.UI/Views/Steps/Step3PlaceholderInputView.axaml` - Complete UI implementation
- **MODIFIED:** `src/DocxTemplate.UI/ViewModels/WizardViewModel.cs` - Integration with wizard navigation and data flow
- **MODIFIED:** `src/DocxTemplate.UI/ServiceRegistration.cs` - DI registration for PlaceholderInputViewModel
- **NEW:** `tests/DocxTemplate.UI.Tests/ViewModels/PlaceholderInputViewModelTests.cs` - Comprehensive unit tests

### Debug Log References:
- Fixed XAML DataType binding issues by adding x:DataType attributes
- Resolved converter type compatibility by using IBrush instead of Brush
- Fixed test constructor patterns for .NET 9 required properties syntax
- Handled Unicode JSON encoding for Czech characters in test assertions

### Completion Notes:
- All functional requirements implemented including dynamic form, visual feedback, and completion tracking
- Integration requirements met with proper data flow from Step 2 to Step 3
- Quality requirements satisfied with responsive layout, scrolling support, and immediate feedback
- All 46 UI tests passing, build successful, no breaking changes to existing functionality

### Change Log:
- 2025-08-18: Complete implementation of Step 3 placeholder value input with comprehensive testing

**Status:** Ready for Review