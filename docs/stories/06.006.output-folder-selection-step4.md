# Story 06.006: Step 4 - Output Folder Selection

## User Story

As a business administrator using the GUI template processor,
I want to select where my processed templates will be saved,
So that I can organize my output files in the appropriate location.

## Story Context

**Existing System Integration:**
- Integrates with: Avalonia native folder dialog, wizard navigation from 06.002
- Technology: Avalonia UI folder picker, file system validation, .NET 9
- Follows pattern: Wizard step navigation and file system interaction patterns
- Touch points: MainViewModel output path property, folder validation, CLI copy/replace commands

## Acceptance Criteria

**Functional Requirements:**

1. **Primary Folder Selection Interface**
   - "Vybrat výstupní složku" (Select Output Folder) button as primary action
   - Launch native OS folder picker dialog when clicked
   - Display selected folder path in read-only text field below button
   - Use standard Avalonia folder picker with proper OS integration

2. **Path Display and Validation**
   - Show full selected path in non-editable text field
   - Validate write permissions to selected folder
   - Display folder validation status (accessible/not accessible)
   - Handle long paths with proper text wrapping or horizontal scroll

3. **Navigation Control**
   - "Next" button enables only after valid output folder selected
   - "Back" button returns to Step 3 (placeholder input) with selected path preserved
   - Clear visual indication when folder selection is required vs. completed

**Integration Requirements:**

4. Existing wizard navigation from 06.002 continues to work unchanged
5. Selected output path integrates with CLI `copy` and `replace` commands
6. Folder validation follows OS file system permission patterns

**Quality Requirements:**

7. Folder picker dialog uses native OS appearance and behavior
8. Path validation occurs immediately after selection
9. Error handling covers permission denied, invalid paths, and network drive issues

## Technical Notes

- **Integration Approach:** Use Avalonia's StorageProvider.OpenFolderPickerAsync for native folder dialog
- **Existing Pattern Reference:** Follow file system interaction patterns and wizard navigation from 06.002
- **Key Constraints:** Must validate write permissions before allowing progression, output path must be compatible with CLI commands

## Definition of Done

- [ ] "Select Output Folder" button launches native OS folder picker
- [ ] Selected folder path displays correctly in read-only text field
- [ ] Write permission validation occurs automatically after selection
- [ ] "Next" button enables only after valid, writable folder selected
- [ ] "Back" button preserves selected folder path when navigating
- [ ] Error messages display for invalid paths or permission issues
- [ ] Long folder paths display properly without breaking layout

## Risk and Compatibility Check

**Primary Risk:** Folder permission validation fails or OS folder dialog doesn't work on all platforms
**Mitigation:** Comprehensive permission checking with fallback validation and cross-platform testing
**Rollback:** "Back" button allows return to Step 3, folder selection can be changed anytime

**Compatibility Verification:**

- [ ] Native folder dialog works on both Windows and macOS
- [ ] Permission validation handles all standard folder types (local, network, etc.)
- [ ] Path handling works with spaces, special characters, and Unicode folder names
- [ ] Integration with CLI commands handles selected path format correctly