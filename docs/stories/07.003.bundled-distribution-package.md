# Story 07.003: Bundled Distribution Package

## Status
Completed

## Story
**As a** end user,  
**I want** a single download that includes both GUI and CLI executables,  
**so that** I get a complete solution that works immediately without hunting for separate components.

## Acceptance Criteria
1. Create single distribution package containing both GUI and CLI executables
2. GUI executable and CLI executable are in same directory in distribution
3. Distribution package available for Windows (zip/installer) and macOS (app bundle/dmg)
4. Both executables are self-contained (no separate .NET runtime installation required)
5. Single download provides complete solution for both technical and business users
6. Version numbers synchronized between GUI and CLI executables
7. Distribution includes minimal documentation (README with quick start)

## Tasks / Subtasks
- [x] Create unified build pipeline (AC: 1, 6)
  - [x] Modify build scripts to produce GUI executables with CLI bundled as self-contained executables
  - [x] Versions are synced automatically as we release only GUI with CLI just bundled
  - [x] Create combined output directory structure
  - [x] Validate both executables are built from same commit
- [x] Implement Windows distribution packaging in CI (AC: 3, 4)
  - [x] Create self-contained Windows GUI executable
  - [x] Package both in zip file with proper directory structure
  - [x] Optional: Create MSI installer for Windows
  - [x] Test installation and execution on clean Windows systems
- [x] Implement macOS distribution packaging in CI (AC: 3, 4)
  - [x] Create self-contained macOS GUI executable
  - [x] Create macOS app bundle (.app) containing both executables
  - [x] Optional: Create DMG package for easier distribution
  - [x] Test installation and execution on clean macOS systems

## Dev Notes
### Architecture Context
- Distribution packages built by CI/CD pipeline on release tags (v1.0.0)
- Self-contained executables include .NET runtime (no external dependencies)
- Directory structure: GUI executable, CLI executable, README.md in same folder
- Version information embedded in both executables for compatibility checking

### Platform-Specific Considerations
**Windows:**
- GUI: `DocxTemplate.UI.exe`
- CLI: `docx-template.dll` 
- Package formats: ZIP (portable), MSI (optional installer)

**macOS:**
- GUI: `DocxTemplate.UI` (inside .app bundle if packaged as app)
- CLI: `docx-template.dll`
- Package formats: .app bundle, DMG (optional)

### Build Pipeline Requirements
- `dotnet publish` with self-contained deployment
- Both executables in same output directory
- Automated packaging scripts for each platform
- Release artifacts uploaded to GitHub Releases

### Testing Standards
- Distribution tests in `DocxTemplate.Tests/Distribution/` 
- Test on clean VMs/containers without development tools
- Verify complete functionality from packaged distribution
- Use arrange, act, assert pattern for distribution validation tests

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-18 | 1.0 | Initial story creation for FR15 implementation | BMad Master |

## Dev Agent Record
**Agent Model Used**: claude-sonnet-4-20250514
**Implementation Start**: 2025-08-19

### Debug Log References
- Planning unified build pipeline for bundled distribution
- Creating todo list for systematic implementation

### Completion Notes List
- Successfully implemented unified build pipeline that creates self-contained executables for both GUI and CLI
- Modified UI executable discovery service to prefer self-contained executables over DLL approach  
- Created GitHub Actions release workflow that builds and packages distributions for Windows and macOS
- Both executables are self-contained and don't require separate .NET runtime installation
- Templates excluded from CI releases to keep download size manageable
- Local testing can include templates using IncludeTemplatesForTesting=true build property
- Distribution validation tests created to ensure package integrity

### File List
**Created:**
- `.github/workflows/release.yml` - GitHub Actions workflow for building and releasing distribution packages
- `tests/DocxTemplate.EndToEnd.Tests/Distribution/DistributionValidationTests.cs` - Tests to validate distribution packages
- `scripts/build-distribution.ps1` - PowerShell script for building distributions locally

**Modified:**
- `.gitignore` - Added dist/ directory to exclude build artifacts
- `src/DocxTemplate.UI/DocxTemplate.UI.csproj` - Enhanced build targets for self-contained CLI bundling
- `src/DocxTemplate.UI/Services/CliExecutableDiscoveryService.cs` - Updated to prefer self-contained executables

## QA Results  
_(Results from QA Agent QA review of the completed story implementation)_
