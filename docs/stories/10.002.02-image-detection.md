# Task 10.002.02: Image Placeholder Detection Implementation

## Task Overview
Implement detection logic for image placeholders in DOCX documents, handling Word's text run splitting.

## Prerequisites
- Task 10.002.01 (Core Models) completed
- Understanding of OpenXML text run structure

## Implementation Steps

### 1. Create Image Placeholder Pattern
**File:** `src/DocxTemplate.Infrastructure/DocxProcessing/PlaceholderPatterns.cs`
```csharp
public static class PlaceholderPatterns
{
    public const string ImagePlaceholderPattern = @"\{\{image:([^|]+)\|width:(\d+)\|height:(\d+)\}\}";
    public const string TextPlaceholderPattern = @"\{\{([^}]+)\}\}";
}
```

### 2. Implement Text Run Reconstruction
**File:** `src/DocxTemplate.Infrastructure/DocxProcessing/PlaceholderScanner.cs`

Critical: Word splits placeholders across multiple runs. Must reconstruct:
```csharp
private string ReconstructParagraphText(Paragraph paragraph)
{
    var runs = paragraph.Descendants<Run>().ToList();
    return string.Join("", runs.Select(r => r.InnerText));
}
```

### 3. Update PlaceholderScanner for Image Detection
**File:** `src/DocxTemplate.Infrastructure/DocxProcessing/PlaceholderScanner.cs`
- Add method to detect image placeholders
- Parse width/height parameters
- Extract image name identifier
- Track position in document for replacement

### 4. Handle Mixed Placeholder Types
- Scan for both text and image placeholders in single pass
- Maintain order of discovery
- Avoid duplicate detection

### 5. Create PlaceholderFactory
**File:** `src/DocxTemplate.Infrastructure/DocxProcessing/PlaceholderFactory.cs`
```csharp
public static Placeholder CreateFromMatch(Match match, PlaceholderType type)
{
    // Create appropriate placeholder based on type
}
```

## Edge Cases to Handle
- Placeholder split across table cells
- Placeholder in headers/footers
- Malformed image placeholder syntax
- Missing width/height parameters

## Unit Tests Required
- Test detection of complete image placeholder
- Test detection of split placeholder across runs
- Test mixed text and image placeholder detection
- Test invalid syntax handling
- Test reconstruction of paragraph text

## Success Criteria
- [x] Image placeholders detected with regex pattern
- [x] Text run reconstruction working correctly
- [x] Width/height parameters correctly parsed
- [x] Image name extracted accurately
- [x] All test cases pass

## Estimated Time: 2 hours