# Task 10.002.05: UI File Picker Integration for Images

## Task Overview
Integrate file picker functionality into the Avalonia UI for image placeholder value entry.

## Prerequisites
- Existing PlaceholderValueViewModel understanding
- Avalonia file dialog knowledge
- Task 10.002.01-04 completed

## Implementation Steps

### 1. Update PlaceholderValueViewModel
**File:** `src/DocxTemplate.UI/ViewModels/PlaceholderValueViewModel.cs`

```csharp
public class PlaceholderValueViewModel : ViewModelBase
{
    public PlaceholderType Type { get; init; }
    public bool IsImagePlaceholder => Type == PlaceholderType.Image;
    
    private string _value;
    public string Value 
    { 
        get => _value;
        set => RaiseAndSetIfChanged(ref _value, value);
    }
    
    public ReactiveCommand<Unit, Unit> BrowseImageCommand { get; }
    
    private async Task BrowseImage()
    {
        var dialog = new OpenFileDialog
        {
            Title = "Vyberte obrázek", // Czech: "Select image"
            Filters = GetImageFilters()
        };
        
        var result = await dialog.ShowAsync(GetWindow());
        if (result?.Length > 0)
        {
            Value = result[0];
        }
    }
}
```

### 2. Create Image File Filters
**File:** `src/DocxTemplate.UI/Services/FileDialogService.cs`

```csharp
public static List<FileDialogFilter> GetImageFilters()
{
    return new List<FileDialogFilter>
    {
        new FileDialogFilter
        {
            Name = "Obrázky", // Czech: "Images"
            Extensions = new List<string> { "png", "jpg", "jpeg", "gif", "bmp" }
        },
        new FileDialogFilter
        {
            Name = "Všechny soubory", // Czech: "All files"
            Extensions = new List<string> { "*" }
        }
    };
}
```

### 3. Update Placeholder Input View
**File:** `src/DocxTemplate.UI/Views/Steps/PlaceholderInputView.axaml`

```xml
<UserControl>
    <ItemsControl Items="{Binding Placeholders}">
        <ItemsControl.ItemTemplate>
            <DataTemplate>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="200"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" 
                               Text="{Binding Name}"/>
                    
                    <TextBox Grid.Column="1" 
                             Text="{Binding Value}"
                             IsVisible="{Binding !IsImagePlaceholder}"/>
                    
                    <DockPanel Grid.Column="1" 
                               IsVisible="{Binding IsImagePlaceholder}">
                        <TextBox Text="{Binding Value}" 
                                 IsReadOnly="True"/>
                    </DockPanel>
                    
                    <Button Grid.Column="2" 
                            Content="Procházet..." 
                            Command="{Binding BrowseImageCommand}"
                            IsVisible="{Binding IsImagePlaceholder}"/>
                </Grid>
            </DataTemplate>
        </ItemsControl.ItemTemplate>
    </ItemsControl>
</UserControl>
```

### 4. Add Image Preview (Optional Enhancement)
**File:** `src/DocxTemplate.UI/Controls/ImagePreview.axaml`

```csharp
public class ImagePreviewViewModel : ViewModelBase
{
    private Bitmap _previewImage;
    public Bitmap PreviewImage
    {
        get => _previewImage;
        private set => RaiseAndSetIfChanged(ref _previewImage, value);
    }
    
    public void LoadPreview(string imagePath)
    {
        if (File.Exists(imagePath))
        {
            PreviewImage = new Bitmap(imagePath);
        }
    }
}
```

### 5. Implement Validation
**File:** `src/DocxTemplate.UI/Validators/ImagePathValidator.cs`

```csharp
public class ImagePathValidator
{
    private static readonly string[] SupportedExtensions = 
        { ".png", ".jpg", ".jpeg", ".gif", ".bmp" };
    
    public ValidationResult Validate(string imagePath)
    {
        if (!File.Exists(imagePath))
            return ValidationResult.Error("Soubor neexistuje"); // Czech: "File does not exist"
            
        var extension = Path.GetExtension(imagePath).ToLower();
        if (!SupportedExtensions.Contains(extension))
            return ValidationResult.Error("Nepodporovaný formát obrázku"); // Czech: "Unsupported image format"
            
        return ValidationResult.Success;
    }
}
```

## UI/UX Considerations
- Show image type icon next to image placeholders
- Display file path or filename after selection
- Validate image exists before processing
- Show preview thumbnail (optional)
- Czech localization for all UI text

## Unit Tests Required
- Test file dialog filter creation
- Test image path validation
- Test view model command execution
- Test UI binding updates
- Test error message display

## Success Criteria
- [ ] File picker opens for image placeholders
- [ ] Correct file filters applied
- [ ] Selected path stored in view model
- [ ] Validation prevents invalid selections
- [ ] UI clearly distinguishes image from text placeholders
- [ ] Czech localization implemented

## Estimated Time: 2 hours